<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Demo1</title>
<script src="phonegap.js"></script>
<script type="text/javascript" charset="utf-8">

var pictureSource; 
var destinationType;
var xc;
var uv;
var xcvalue = 1;
var uvvalue = 0;
var selectedInput = 2;

document.addEventListener("deviceready",onDeviceReady,false);

function onDeviceReady() {
xc = document.getElementById('xcrate');
uv = document.getElementById('uvalue');
getLastValue();
setSelectedInput(2);
updateDisplay();
pictureSource=navigator.camera.PictureSourceType;
destinationType=navigator.camera.DestinationType;
}

function updateDisplay() {	
	xc.innerHTML = xcvalue;
	uv.innerHTML = uvvalue;
}

function setSelectedInput(which) {
selectedInput = which;

if (which == 1)
{
xc.style.borderColor = "#0094FF";
xc.style.borderWidth = "medium";
uv.style.borderColor = "#000000";
uv.style.borderWidth = "thin";
}
else if (which == 2)
{
uv.style.borderColor = "#0094FF";
uv.style.borderWidth = "medium";
xc.style.borderColor = "#000000";
xc.style.borderWidth = "thin";
}
}

function user_input(what) {

var result = 0;
if (selectedInput == 1)
{
	result = xcvalue.toString();
}
else if (selectedInput == 2)
{
	result = uvvalue.toString();
}

if (what == "dot")
{
	if (result.toString().indexOf(".") < 0)
		result = result + ".";
}
else if (what == "bksp")
{
	result = result.substr(0, result.length - 1);
	if (result == "")
		result = "0";
}
else
{
	if (result != "0")
		result = result + "" + what.toString();
	else
		result = "" + what.toString();
}

if (selectedInput == 1)
{
	/*if (result == "0")
		result = "1";
		*/
	xcvalue = result;
	xcupdate();	
}
else if (selectedInput == 2)
{
	uvvalue = result;	
}

conversion();
updateDisplay();
}


function onPhotoDataSuccess(imageData) {
var smallImage = document.getElementById('smallImage');
smallImage.style.display = 'block';
smallImage.src = "data:image/jpeg;base64," + imageData;
}

function onPhotoURISuccess(imageURI) {
var largeImage = document.getElementById('largeImage');
largeImage.style.display = 'block';
largeImage.src = imageURI;
}

function capturePhoto() {
navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50,
destinationType: destinationType.DATA_URL });
}

function capturePhotoEdit() {
navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 20, allowEdit: true,
destinationType: destinationType.DATA_URL });
}

function getPhoto(source) {
navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50, 
destinationType: destinationType.FILE_URI,
sourceType: source });
}

function onFail(message) {
alert('Failed because: ' + message);
}

function isNumber(n) {
	if (n.toString().substr(n.length - 1, n.length) == ".")
		n = n.toString() + "0";
		
  return !isNaN(parseFloat(n)) && isFinite(n);
}

function conversion(){
var infobar = document.getElementById('infobar');
//infobar.innerHTML = "- A";

var xcrate = isNumber(xcvalue) ? xcvalue : 1;
var uval = isNumber(uvvalue) ? uvvalue : 1;	

	try {		
		var result = uval / xcrate;
		var resultdiv = document.getElementById('amt');
		if (isNumber(result))
			resultdiv.innerHTML = "$ " + result.toFixed(2);
		else
			resultdiv.innerHTML = "Error";
	}
	catch(err){
	resultdiv.innerHTML = "Error";
	}
}

function xcupdate()
{
try {
	window.localStorage.setItem("last_xc", xcvalue);
}
catch(err) {
}
}

function getLastValue()
{	
	try {		
		var v = window.localStorage.getItem("last_xc");
		if (v != null && isNumber(v))
			xcvalue = v;
		else
			xcvalue = 1;
	}
	catch(err){		
		xcvalue = 1;
	}	
}

function clear_value()
{
uvvalue = 0;
conversion();
updateDisplay();
setSelectedInput(2);
}

function invert_xc()
{
	xcvalue = 1 / xcvalue;
	xcvalue = xcvalue.toFixed(2);
	conversion();
	updateDisplay();
}

function clear_xc()
{
xcvalue = 0;
xcupdate();	
conversion();
updateDisplay();
setSelectedInput(1);
}
</script>
</head>
<!-- <body  onload="onDeviceReady();"  style="background:url('res/bg/bg2.png') no-repeat; font-family:arial;">  -->

  <body style="background:#333333; font-family:arial;"> 

<div id="infobar" style="color:white; font-size:larger; padding:5px;">Demo v0.0.15</div>
<!-- 
onload="onDeviceReady();"
-->

<div style="float:left;vertical-align:bottom;"><img id="img_inverse" onclick="invert_xc()" src="res/btn/inverse.png" style="width:24px; height:24px; border:none; margin:3px 0px 0px 0px; padding:0px 5px; vertical-align:bottom;"/> </div>
<div id="xcrate" style="border:1px solid #000000; text-align:right; color:#ffffff; vertical-align:bottom; width:55px; padding:5px; float:left;" onclick="setSelectedInput(1)">
</div> <div style="float:left;vertical-align:bottom;"><img id="img_clear_xcrate" onclick="clear_xc()" src="res/btn/btn_cancel.png" style="width:24px; height:24px; border:none; margin:3px 0px 0px 0px; padding:0px 5px; vertical-align:bottom;"/> &nbsp;</div>

<div id="uvalue" style="border:1px solid #000000;text-align:right; color:#ffffff; vertical-align:bottom; width:80px; padding:5px; float:left;" onclick="setSelectedInput(2)">
</div> <div style="float:left;vertical-align:bottom;"><img id="img_clear_value" onclick="clear_value()" src="res/btn/btn_cancel.png" style="width:24px; height:24px; border:none; margin:3px 0px 0px 0px; padding:0px 5px; vertical-align:bottom;"/></div>


<div style="clear:both;">&nbsp;</div>

<div id="amt" style="margin:10px; font-size:xx-large; color:white; font-weight:bold; display:block;">$</div>
<br/>
<div style="margin:0px 5px 0px 5px;">
<img src="res/btn/1.png" style="width:60px;height:60px;" onclick="user_input(1)" /> <img src="res/btn/2.png" style="width:60px;height:60px;" onclick="user_input(2)" /> <img src="res/btn/3.png" style="width:60px;height:60px;" onclick="user_input(3)" /><br/>
<img src="res/btn/4.png" style="width:60px;height:60px;" onclick="user_input(4)" /> <img src="res/btn/5.png" style="width:60px;height:60px;" onclick="user_input(5)" /> <img src="res/btn/6.png" style="width:60px;height:60px;" onclick="user_input(6)" /><br/>
<img src="res/btn/7.png" style="width:60px;height:60px;" onclick="user_input(7)" /> <img src="res/btn/8.png" style="width:60px;height:60px;"  onclick="user_input(8)"/> <img src="res/btn/9.png" style="width:60px;height:60px;" onclick="user_input(9)" /><br/>
<img src="res/btn/dot.png" style="width:60px;height:60px;" onclick="user_input('dot')" /> <img src="res/btn/0.png" style="width:60px;height:60px;" onclick="user_input(0)" /> <img src="res/btn/back.png" style="width:60px;height:60px;" onclick="user_input('bksp')" /><br/>
</div>
<!-- <button onclick="capturePhoto();">Capture Photo</button> <br>
<button onclick="capturePhotoEdit();">Capture Editable Photo</button> <br>
<button onclick="getPhoto(pictureSource.PHOTOLIBRARY);">From Photo Library</button><br> -->

<!--<button onclick="getPhoto(pictureSource.SAVEDPHOTOALBUM);">From Photo Album</button><br>-->
<img style="display:none;width:60px;height:60px;" id="smallImage" src="" />
<img style="display:none;" id="largeImage" src="" />

</body>
</html>

